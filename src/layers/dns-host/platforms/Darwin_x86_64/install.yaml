- name: "installing dnsmasq via brew"
  homebrew:
    name: dnsmasq
    state: present

- name: get brew root path
  shell: "brew --prefix"
  register: "brew_prefix"

- name: create dnsmasq etc folder
  file:
    path: "{{ brew_prefix.stdout }}/etc"
    state: directory
    recurse: yes

- name: setup dnsmasq port
  blockinfile:
    path: "{{ brew_prefix.stdout }}/etc/dnsmasq.conf"
    block: |
      port=53
    marker: "# {mark} ANSIBLE MANAGED BLOCK"

- name: create dnsmasq local tld conf
  file:
    path: "{{ brew_prefix.stdout }}/etc/dnsmasq.d/{{ dns_host.tld }}.conf"
    state: touch

- name: create resolver folder
  become: yes
  file:
    path: "/etc/resolver"
    state: directory
    recurse: yes

- name: create resolver folder
  become: yes
  file:
    path: "/etc/resolver/{{ dns_host.tld }}"
    state: touch

- name: setup local resolver
  become: yes
  blockinfile:
    path: "/etc/resolver/{{ dns_host.tld }}"
    block: |
      nameserver 127.0.0.1
    marker: "# {mark} ANSIBLE MANAGED BLOCK"



